generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DB_URL")
}

model Machines {
  id              String         @id @default(cuid())
  name            String
  model_name      String
  status          MachinesStatus @default(ACTIVE)
  type            MACHINE_TYPE
  temperature_max Float
  vibration_max   Float
  power_max       Float
  thresholds      Json
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  assignments     Machine_Assignments[]
  alerts          Alerts[]
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  role      Role     @default(MAINTENANCE)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  password  String

  assignments Machine_Assignments[]
  resolvedAlerts Alerts[]
}

enum MACHINE_TYPE {
  CNC
  HYDRAULIC
  FURNACE
  ROBOTIC_ARM
}

enum MachinesStatus {
  ACTIVE
  IDLE
  MAINTENANCE
}

enum Role {
  ADMIN
  ENGINEER
  MAINTENANCE
}

model Machine_Assignments {
  id          String   @id @default(cuid())
  machineId   String
  userId      String
  assignedAt  DateTime @default(now())
  unassignedAt DateTime?

  machine     Machines @relation(fields: [machineId], references: [id])
  user        User     @relation(fields: [userId], references: [id])

  @@unique([machineId, userId])
}



enum AlertType {
  WARNING
  ERROR
}
enum AlertStatus {
  PENDING
  RESOLVED
  UNRESOLVED
}

model Alerts{
  id          String   @id @default(cuid())
  machineId   String
  resolvedById String?
  alertType   AlertType
  message     String
  status      AlertStatus  @default(PENDING)
  resolvedBy  User?    @relation(fields: [resolvedById], references: [id])
  resolvedAt  DateTime?
  reason      String?
  createdAt   DateTime @default(now())

  machine     Machines @relation(fields: [machineId], references: [id])
}
